package com.example.myhouse24user.controller;

import com.example.myhouse24user.entity.ApartmentOwner;
import com.example.myhouse24user.entity.OwnerStatus;
import com.example.myhouse24user.model.owner.ApartmentOwnerRequest;
import com.example.myhouse24user.model.owner.EditOwnerResponse;
import com.example.myhouse24user.model.owner.ViewOwnerResponse;
import com.example.myhouse24user.repository.ApartmentOwnerRepo;
import com.example.myhouse24user.service.ApartmentOwnerService;
import jakarta.xml.bind.DatatypeConverter;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.mock.web.MockMultipartFile;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.test.web.servlet.MockMvc;

import static org.hamcrest.Matchers.is;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.when;
import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;
import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.user;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.multipart;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;

@SpringBootTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@AutoConfigureMockMvc
class ProfileControllerTest {
    @Autowired
    private MockMvc mockMvc;
    @Autowired
    private UserDetails userDetails;
    @Autowired
    private ApartmentOwnerService apartmentOwnerService;
    @Autowired
    private ApartmentOwnerRepo apartmentOwnerRepo;
    private MockMultipartFile multipartFile = new MockMultipartFile("mainImage",
            "file.jpg", MediaType.IMAGE_JPEG_VALUE, DatatypeConverter.parseHexBinary("FFD8FFE000104A46494600010100000100010000FFDB0084000A07081516151815161618181818191A18181919181C181818181A181C191A181A1C1C212E261C1E2B2118182638262C2F313535351A243B403B343F2E343531010C0C0C100F101E12121F342B242B3634343434343636343434343434343434343434343434343434313434343434343434343434343434343434343434343434FFC00011080091015C03012200021101031101FFC4001B00000105010100000000000000000000000401020305060007FFC40044100002010203030904070702060300000001020003110412210531410613225161718191B13252A1C14262728292B2D114152353A2E1F043D2162433B3C2F13473E2FFC400190100030101010000000000000000000000000102030405FFC400271100020201040201040301000000000000000102111203213151134122043261811471D152FFDA000C03010002110311003F00C9848E0926091E127B07103848E0927091E12302014E28A708091C12000E1228484848A29C0018245E6E15922848002737179B85E48BCDC000F9B9DCDC339B9DCDC000F9B9DCDC339B9D920203E6E27370DE6E27350003E6E27370DE6A2737000334E76486737139B8001E4899217CDC4E6E00099227370CE6E77370002E6E77370CE6E27350003E6E27370CE6E2648001E4899219CDC434E000669CE34E17CDCEE6E000469C434E199221488008A4694869A71A69C000F2C4290A34E2148A86085234A430D38C290005291B921452372C00B4091EA91EAB2455960078AC4A5300B9B03A0D0EA7AA0C36D51E058F70FEF0ADB3852F45EC3A4A33AF7AEBE97128D7074D806CA3500DF28E3DC2736AEA4A2E91AC22A4B72C7F7F52F75FC97FDD3BF7F53F71FF00A7F5954767D3EBB78B01EA4441B301F66A7F52B7C84C7F93234F0A2DBFE204F71BCC4E3CA15E087F17F6950765B8E20FDDB7E52634E0AA0DEABE0C47E6510FE44BB0F122DCF28FAA9FF5FF00F99D4B947D2E9A747EA9D479EFF84A5341BDC6F0CADE8C6308B6FBAFDA565F511F9E5D878D746CB0DB52838D1D4763744FC648FB4288DF517C0DFD2620153B8A9EE61FAC939B3D465AD7647891AD7DB1407D3BF729F9890B6DFA237073E03F5997CB3AD0F331F8E269E9EDFA277865F0BFA43296D2A0DBAA2F8F47F34C6658B682D6903D389BCA6CADECB2B5BA883E91FCDCC025C1B8241E041B11E225961B6D574D33E71D4E337C77FC65C75D7B44BD2E8D6F37139B95186E5321D1D197B54E61E46C47C65BE171D4AA7B0EA4F56E6FC2759A4671970CCDC1AE44E6E77370CE6A26496203E6E21A727AD5113DB655EF204ADC4EDCA49BB33F70B7ADA4B94572C6A2DF015CD44E6E4786DAF41F73853D4FD13E6743E06580A7D51A927C09A6B902E6E27370EE6E34D38C00F9B89CDC339B9DCDC000B9B8869C3324E34E000269C434E1DCDC69A710011A710D3869A71A69C0008D38D34E1A69C69A7000134E34A434D38C34E00065234D3869A71A522001291B921869C6F37028355648AB39449156592704991C8519E99FA0E40FB27A4BF0226CD5666F94943255471B9D729FB49A8F304FE19CFAF1B8DF469A4EA5459EC7C32B52048DE5BF311F2853ECC43BD41F011393CBFC04EF6FCE65A849E5497C99DF17B14CDB129F016EE257D230EC4EA771F7AFEB2CF178C14C80559AF7375CBA5BAEEC246BB569F5B0FB8C7F2830C641922B1F633F07BFDA507D2D207D95546ECA7BB32FEB2EDB6927BE07DAE8FE6B41F11B4BA272329363A820C3E4BD8B633628E7BDD54D8904101B51BFDA1AEB233B3C7044FBB743FD0C21780D50182E1B1B55F11CC2223317C8809C9737B0B926D356D25B9156C8DB076E0E3B9F37C1D4C61C37D661F6A9AB7C5594C96AEDA28E51E9D9949536707506C784726DDA477AB8F007D0C6A4BD307105387EA74EDBE74F5561F18D6C3BD890AAC0024E4746B01D8483F096C98DA0E37F9A91F2886961DB8A5FB1B29F58D4FF0022C4A6B44B4BC3B390EE63F8B37C4DE31F63F53F9AFE844BCD13894F1A6D2CAA6C77E0CA7CC7EB02C46C9C45BA2ABDE1B5F0B811E4854C726DEA94745763D4A4E61E4DB87943E96D5C5564CCCC897DCA03A5C75E65B9942BB2EB29B9A6C4F5E8DE865C6C6C2BBD44572402751A836F5932D4925B31A826F7431F0F53795B9FAAEA6FF8B2990BE1D86A51C77A31F8AE61362DB0BDD771E37FCD7903EC5A837383F697F4B4C96B1A60640E5DD996FD44853E4D6308C3BD44D519D7EC9397C40D0CD054D9D5C7056FBC47C083017D9C41B9C38BF5AAA5FCD72996B5912F4D8987E51565D1C2BF78CADE6BA7C25B61B94945BDB0E9DB6CCBE6BAFC251BE1946F5A8BE2E479366122E61370A9AFD6553F97219AC7EA5AF644B45746DF0D88A6FEC3AB77104F88DE24DCDCC11C03684142471BBA1F0D1BD61943198A4B056661D4592A0EEE9306F29B47EA63ECC9E8BF46C39B89CDCA2A3CA575D2AD161F5955D7F38CBFD52D707B6F0D5345A8A1BDD6201EEBEEF8CD63AB17C321C24B944E69C434E1A29CE34E559340269C69A70EE6E34D38585001A71869CB034E30D38585001A71869C3DA9C6353858C00A469A70D34E319216002C919CDC39A9C8F240055125411A925413533B1E8256F2970B9F0ECC37A10E3EEFB5FD25A5B208FC80820EA08B1EE3BE44E39268A4E9D95DC98D70C87B5FF3B4B8092BB937862987543F41EA2F78155803E22C65C059E2CBEE67A51E1151B412EEBF64FA88CA18704EA2F0EC5A74D7EC9F5124C352D674C5FC0C65F715F4308A735C6E62077692BB943B3D0522D6D6E3D0CD1E129FB5F6CFCA01CA7A5FC03DE3D0C96C7467765D2B25BB4CA0C7ECE6E71D8684BB1FA434E1AEE3353824B2F8CBCA7B233223874E98B8196A5EE09523A2875B8333926D171A4796B601F5373A5B883BEFD7DD194F08C4851BC9005C0035D3537B0EF9EC5B276415762590DD4699AC779E0C04B27D8A8DBE9D36F04692A3B720DEE78E617195285374B029580D72826CA430B122EBBC6E8056AC27AD63B93399500A2405CC00086C0746C0586ED26776D72592CA591D77EAA2DD5BEE0CC5CB1934D1A2568C86CBA749CB739539B0118A90A5B3381D14D375FAF8489316E373BFE236F5976DC98A1C2AB8EF0A7D0082BF262D4C38AA2E4DB258DEDAEBBED6D3E312D48B7C8DC5F44782C7E21DD115EECCC157365B5C9B0B96161E727C46D8AC8CC8D9095241D388363AA9B195A764BAD454CD7B95DDDA6DD508C4EC571C4CBCE9F22ADB8255E5430F6A9A9EE623D4193ECEDBEAF89A442105995002DA5DDD45EE06E1DD33B83C1B3B017B5CDAE75F84B4D9D860B8AA000DD5690BF7545D66A9DBA3367A5B57A837D127ECB83F060227EDC3E953A8BDEA0FE52668D06834836D24052E545F326B61EFAC551BA0C994CB8BA67891F691D479B281156AD36D03A1EE6527D658BE114FD110738146241504581B102D7BB75CAF1A7C066C85B0C0F09054D9E877A83E106DABFB1E1C5DECAFC15090E7AB4522DDE6C26468ED8C5D445A34CB697CCF725DAE49D5D8F406BD9BB7C97A60A65DED3A583A442BE50EC400A9ED6A6D736F64769B4EFDDB44FB15187DFCDF03799DFD8A85160D52A73D501CC69D3B900DEFD3A9A5BB6DAF7CD5AABB004E1DAC4020A540DBC5F7325E52847F22736434F62B93D1AC00E25BA24776502FF097182D814C10CEFCE91A8CC14ADFAEC6E7E328EA965DD42AAF694F9A9F941FF79DB7E71C352DE56616E337838C4CE5948DF73710D3989A5B788DCEFE6A47C0885D3E51BFBE0F7A11F1379BAD68B327A6CD51A71A69CA14E52B71087B9B5F8DA149CA15E34CF7820FC05E529A62C196269C69A7064DBD44EFCCBDE2C24E9B4E836E75F8CACD0B1635A9C8DA9C2D6A21DCEA7EF08E34E3C85457B5391B5387B538C6A70B0A006491F370E6A71992161462793FB62D6473D1DCAC7E89F74FD5EA335AAB3CCD69B29B58DFAAD367C9AC53B2E46562A0745883A5BE892778EAF291A3AADFC595AB0AF922F90463E3110904369D80FCE10AB2A76AA0CE7B84AD79B846D19E8C54A54CBAC2545750CBB8DF85B890743DA0C242C03628FE0A7DEFCE65889E5CA5949B3D08AA5446F860E75E03BB8C968ECF5077903B0FCE394DA39AA194A4AA8971776752C00D6CCC353B88EBB5F74AFE51600F30DD336DF620705277F8433F682BD475BFCE03B4F1CCF4D90802E0EB7DDA11F392DF4C12ECA1C2D3B2D89BEBBF74BEA0E32E1EDBFA5ADD7855A9DB799BC155BA8336180C32E4A2C519CA863D17541667661A1537366EB9527490F92C70D59FDE6FC4615CF9E258F5685B88DF61DDBE478574D6F4EAA69BCB23DF7E9D18FA8949AC7A62DD680F153A59BB245D034207FAA9F817F48CC4E218150B71D7959D7E920E0DA6F316A3D2517CEFBFF92EC7C92E63579A623F88375EE55D2DD25DE19645D32FD12D836F04F7B16FCE1A3D30A9900288CA34E925327E0800923D3402FCE265EB2E00F33170E73E88F4DC686EB515AC4DF4B0EE1C78C1099558ED8D86765714915811AE46DC0DFE83A7571BC0DF645072C32019788675BDFABDBB4D0D4C23EE02FDC41F9C01705503BF41CFDC263693609D18C1C8BA0999FA602DD8DABE6D05D8E8D865F581D1E4FD35C5214772A8E8DD25504B2B66B5C1F6741C3AE6D31F86708F74703231272B0D329BF0947497FE6343F4F7F1F646BAC77BD052E4D1A55B70BC6626A075CB6B6AA77FBAC1BE502C76D1A54101A8F6D3BDDB85EC3FF53238FE53D7AB75A09CDA6ECED6CDE7B97BB7F54ADDEE4D246BB6A6DBA1457F88429EA06ECDDCBF3DD315B439555EB315C3A9A6B6B16D0BDB5E3B937F7F6CAAC4E17229A8F7A8DC6EC4024F12779F84E6C3122CEE2DC113A2BF846A7C6F1B925B0B1055440C4B16ACE4EA14E97FACE7E52774AAD746E82000E44E88D6FBCEF3BA1F81A4CAA32A35EC01FA1EBAC2A961DF316BAAE6001B5D8E97E3A75F6C9F9B029FF610AA6C2D6077774F4FD954AF4699FA89F944CA8D905D339CEE01D4936007685B5F86F9ADC261C045B5C7446E6206E1D4638A715B89EE1430F02C0E1417C4022FFC45DFFF00D14A4A730DCEFE60FA88948B296656D5C82D700DC850A0F0B68A0784BC83163AA6C5A2FED5246EF45FD25760F92B8776AC0D21D0AB9572965B0E6E9B5BA2471627C65BA635C6FC87C08F4686ECCDA6B4F39280977CE6C78E454B6A3A9044E418B33B5790D40EE3517B9C9FCC0CABC172473A2BAD52A4DF464471A315ECEA9B6AFB7093EC103B0AFF00695B80C604408C1AE0B6B6046AE5B81ED8D05332FB4360D7A699B3D1619913D8746E9BAA03D17B68581F080E2793D8C1B8533DCF7FCEBF39B2DA988574CA09BE7A6D6CA468B511CEFEC530CA756931B6741F6982FACB4DF64D7E0F30FD871418D3148160AAC556D70AC5829BAB5AC4AB794D06C4D89895757A99500D4A8A85D8E9B8802DFD53429480C639041070F4C6604152454AA4804697008D3B475CB2293683DB9225D013248D921AC923649AD99D00B2467370C648CC91D8518CC5726AA32B29CAA5972E606F96FC6DA6EDF0AD87B22A50B86AD9D6DEE6524F59E91B9EDF59B3DB4A8BB88F3128B9DFB3F8BFB4E08EBCA2ED246EF4D495122ACADDA585766BAA922C374B05A87EAFE2FED25573D43CE56A7D44A71A690A1A2A2ED15D81C13E41D3743AF445AC353C08308185ADFCF7F14A7FEC86873EE9F311CB50FBA7E1FACC0DEC0F9BAC3FD5F345F95A21FDA06E7A67BE9B7C9C43129BBB596CBA7D207CC107FCD64FFBB2AFBC9E4DFAC283245254AB5C6FE6CFDD75FF00C8CAEC662AA8562510D81DCE470FB3348BB32A3DEC534363A1DE3C656EDCD95529D2773948B5B4D37E9D71A15A33DB2DAE82E3AFD65EE1B9614100A6C952E9D12422904AE971D3BFC253ECBA2D908B6AA0B1D468A0817F323CE5E6036223D98A8BB6A7C758B5A4E314D15156C2A9F2BB0C7F983BD1BE44C9872B709C5D877A54FF006CB0A5C9FA797D91E52B71BC9AA47E8CE65AD2E8BC63D93A729B0A77561E2187AAC9D76DE1CEEAC9F880F599E7E49E1DBDB67400E990124F7F41AC3C254D4D8385FA18C07ED15FF6097E57D028237636A503FEAD3F174FD628C5D23B9D0F7153E8679DBEC8A634189A67EF27F690FEC0A2F7AE9BB4B58EBE0E22F37687E33D21853620E54246E36B91C743E027330EAF22C2793D7C33022D515AECAB65041D580F78F5CBEC36C4210124DFCA3F2C5FA178DF66C5AC068CEB6F76B545F4612AF174DBA4C848621BA45AE731160D73724F6C6D0C1A045D35B75987E1685C0504EA40DE78913646527464BF6124DDC977E2CDD7D83E7C7AA1298603FCDDDC3841794DB51F0EE42A29E965B9277D89DC3BBAE66AAEDFC4B6E6541F5545FCCDE57F608D855C3AB0B30B8EAE1E3D7207C4D1A7BDD13B2E07C2622B622A3FB751DBBD8DBE1235C293AE527B6C4FC63B0A35B5B943875DCC5BECA93EB02ABCA91F42913DACC07A4ABC3EC9AAE0144241DC6E00F8996D4F9198A201C8801FAE09F84793152375B0939CC173EC002541207026FA6B351B2F0E1A95FA947A4CDECAD9755302B4D810CB7E85975BDACC1AF7E0749A1D974DB21D4AE54E9016B9E8DAC6FC2FD524CEAAC1EA2EB20ACE114B31B002E4CC6F2819FF0068A856B554175E8ABD80E82EE10018AAA405E72A30E219C9BF7EB68A6D46AFD959247A061AA2BA865D418E65987A7B4312A064AB940E054308E1B7317C6A21FB801F532E31725635246CD9642841008370664AB7282B8521B2B5FA2458697EBB28B08361B6FD6A6A888A8416E916CC728EC0186F36D7E121CD29623C91B6C62154CC05F86A6C353D70267FB3E7FDA59ED4AF7C31017D9B10FA58DEFA6FB9DD7DD695FA5868370948102971C403DC41F597C36C53EA71E00FA1333B8CC4056545F689008BF03247A4BD52E326AE84E2A5C97DFBDA8FBC477A37E927A4EAEB994DC75EA3777CC93D31FE5A6A764A01452DD44F9B19AC24DBDCCE514B824648CC90868CB4D2C9A00C4B3B163500CF98DEDA5C5F43E5682E512E36AD15BDC01ACABCB3828DD3D86841D51D90750F28A04708058D14D7DD1E51C117DD1E50FC3ECA7750EB96C775CD8EFB75491B63D4009E8E82FED7F68E80AFC3E2551CD87B232917B0B9E9DC1FBDF2E10C1B507BBFD5FDA368A29037790F9C78A6BD9E4BFA47886C330D8E55CDA5F3316DFBAF6D241B6EA0AF45A9A90A5ADA9371A1BF0867363B3C97F48E148750F25FD2188F63CFF1343239424311C4768066B7038A5A7451DAE4055BD85CEE1C38CCA6DB7FE3B8EDF90962D88B514EACABC40E1DB33D6FB5150E59A8A3B7D0B0402E4EEB71D74B778D7C4431DC38BDAD79E4A317556B591AFAE8D7DD9AF700EBA8B5CE9C0F5CF42D935FA0AA0865B68474AE78924F5EBA4E556A411936DD96D44583DBDD3E8667793D87A46851CD491892C2E57A47A5C4DE5CE22A591BBA67363E208A14C8FA2588FC47F49A3FF0D522BF6DE0505740B4D4291A809941F6B7FF009C20589D954ACC722FB24EE1D465A62717672A48E905B5AC3767FD60D8924AB5BDD6F43264DAA296E01B3F0C0D1A1A7D3A7FF7009BAAB85012647638FE151FB74BFEE09BCC47B1E1324F7FD8E467EDA49B08A732D8DBA405F4B8BE971704697BEE90D53A99D4EA585FB47ACEF5C1CB2323CB7000D4663CEDB79B7B2FAE932AB88D34441F7737E7266A3962E3203606F506FBFBAFD444CB2E27A9107DDBFE6BCA634345661A836EEE8FA6E9D9DDC85B9624D8026FA9E02F1E98B71BB28EE44BF9E5BC2F63E21CE229DD8EAE01D6D71D46DC248CD072719B9AC8458A311BBAFA5A93BCEA774DEE12F9537FB2BD5D5DD315B04934D8924FF11C0B9BD80CBA0EA9B7C1FB09F657D04D1F067ECB8C657534D425AE346170483DB2A0ED6A74894770ACEBA037D45C8BE9DB0A47BA91651637B80416246B7EBDD2936BE23238B123A07ABB6DBE24812B456ED0AD4199896A7DA4DAFBBAE55B6168ABA59D4ADC6619C6838EBE5253B41C3A286D0B016B2DB561AEEED304FDE2E4DC9EB16000B0BF7764528A96CC1C4BBA4F8501B3BA3EBD10194103AAF9B5F840B19FB3E8502EBC03DF5EAD18C11F147B0F6155D74EE95FB4F1643B0CA83406D907150DF39A47E3C30C43E9B270450C778D09F1206B35786A0869A5E9A1E82EF4BF01F566370CDEC6E17A68C40000D44DE60CFF000D3EC2FE510AB4095322AF53A0548E8806CBAE51A70045A573D6B5BB84336D1B51A87A96FD930B8BACA54358022DB8586BDDBE0A90CB1DA98B7572C97D7A20F1536173AE9FFB96F80766452E6ECDD96E1F1DC666025C005869A0D1B5EFB9D4EF9252440FA853A5EDD2038F51EC89249D86E1DB5768D44A8C965005AD7049B11DFDF2D365EDFA8292EABA5FE8FD63DB3218FAD9AA8B00A028161988DE7DE2759A2D9DFF00497C7F31969F42ADF7341B2F6BBD4A81085B58936041000EFEBB4BABCCCEC9C4047626C065D4F56A21988C7B5FA352981D445CDFBF38F49AC1368CA4D265B626A5E0044959E32711AA1008E891603347850798421D932824E509AEA7DF047A4929DF2B9CEEE0065B32A0170378CAA24780CD9100CC0653722DC49F8E9F18F67601B366D55BDA23436BF0EF23EECA028E91D04915E0D4DF413B3CD1082B38FF000C5E7075C181EC8B730A0307B75FF8EFDFF2125A949DD135B2E51DFB840B6FBFFCC3F7FCA4189DB052900845C596F6BD883A8D665AB1B491707BB2D309B2C87F6ADD120F56A45EDD5A1B4D5606984161A4C3ECFDB0EC492DA8D370E3AEEB764B3D9FB71854CB51FA27451940E95C5B5B6EDF39FC696E6948D5636BD90F8CCFEC7A9FF2E9DC7F3B4B2C4D4CE9D02ADDCCB6F3BCA4C06131094D50D31A022FCED21BD89F7BB644B97FA348F043B41ED88A6071041EDDE6DF01E509C4E88C4F537A48EB6CDAED552A644012F706BA6BBF8DFB64D8BC2D7752B9692DEFBF1086D7EE59324DD14AB707D8F54737407D7A7FF704DCD67D2627676CB745A619E9DD1D19AD50116570C6DE134B571C9BB3A9E1A1BC95176FFB0603897D4F7C1DEA6862E29FA460759F49E8456C8E49725172AEA5917407A6378BFD169994C49F753F02CD072A2A108B6B7B637807E8B75CCE2624F527E05FD2390D0F18923826BF510F95C690CD918826BD3D17DA034441A7658687B77CAFE7FEAAF97E90BD935473F4FA2BED8EBD3B46B268AB361B0DEF4DBB2A541A00382F56F3DB36B813D14FB2BE8261B61B5D1F402D51C697D745D753BFBAD36B836E82FD91E934F465ECB270A069C753ADE65B9462EE00D094B5FAB53340F525763B67A5460CC5B416B022DBC9EAED820463DA815AA9724F4D0E8BA5B30DE78400D3EBCFBEFEC76F5DE6E1B60512E1CE7B8B1B06B2E86FA8B6B223C97C3710E7EFB7CA08AB3275E8104105B50A744BF0DC75DF07DA98625CF45F555F65030D100DF98754DCBF27B0CD6BA368028E9B8D00B0DC64788E4C611DB3353B9B01EDB8D00B0D03462325851D241AE94D175B03700EF00E87B26FB047F869F617D04AD1B0B0D4D4E4A796C09F69CFA98660DFF869F617D0462F647B6C5E8541F51BD279E55A472585FC720DDF7CF5CF48C400CACAC01520820EE20F032ACECCC36EE6A9F76507FCDDF0850CC7AA5801727C53FDD1CCE54D8EA35BEAA0EEB69ACD5BE0687F2E9FE053F290BE1688FF004E98FB8BFA4742B32788A76746D7A4A0EA2D6D4E9DBDE349A3D9E7F84BE3F98C73AD2DC02750B0590E15C0403B5BF318D2023DA4DA274730CEA581B5B28B937BEFE12BDA995272B8218E6DDBAE0747C2D0ADA78B08972B9AE6D6EFBEBF099F7DAA97F6079089C9A1527C9EAC1E7071306FB7DD864BE96B76E9DDE10BD9BB50822E781F017D2712D657542CB73679A0F5B68D3417675B682F7BEFDDBA65AB7281C365B8B6BBEDD5C2DFE6B287F6866240E2789BDBBAFBBCE396AFFCA0CBA3D1F0D8D4A80943700DA4C4CA6D8A11500562D7D493BEFC7D65A069A46DA56521C7156D237F6D81556E91EF8D0E27425B007FED87B677ED67ABE30135670AB0A63D8AEC66C2151D9D9C8CC6F60B7B78C1BFE10A776BD5721B5B0502C4CBA156385690E0D8D345461F9254D7FD5ABC3820DDE10BA3C98C383762EE75D59869716E16868ABD91E2A497A45643F01B368D219550B5CDFA4DC4F1D2D0B094FF0096BF89BF581AD431DCE43C41985DA9FF002D3CCFEB389A7FCA4F2827393B343C283309629FCA4FC20FCA464D3FE5D31F714FCA4258C4CD1F850B316B2A137216FDDFDE0D52929E0BE52631856528512E457627008E2CCA08EE80D4D8B47DC4FC23F497A5244F4CCAC50B233AFB0289FA1E448F4323A7B0511D5C06054E6F689DDDF340F48F0835747B1B293DD162879306D934C2A1B1BE672C751A1200B69DD35787AA02AEBF447A4C6EC9A4E99C3A900BDD6FD561FA43F178B20000DB4D35EC89F04D9A54C6235ECC34816376C2202DBEC2FA78CF3E18A75E3A16B5AE6FA7F66F876471A8E4B5EF7D4D8F80F3D2F31CC9C99AF4E56A142D62180D14F136E1E302D9BCB177608C8A49602F72BA1E3A03E932F824CC4D85CEB61C37691C982A81F2F36E01D2F90DBCED693949AB0DCDF63F94D469E972C7A97BEC4F8402A72C298622C480091975BF5777C664FF007457CED7A66C776AA2FA8DDAEF84D4E4ED636754DFC2E2E2C3596DCDB7487B87ED5E555436C96008EF3BBB3BE2A72A8AA22E5E90502E74B9EEEA82B7266A11999D10EFCAC6D6DDBCC6E2B6186001AF4D6DBF292D9ADBAF6DDF18AA7761B869E56829A8399AE01E00DB43FE754CE2E2AAE70D9CDDAC0906D7B19689B228037351C9B58E55D0EFD403DFF18FAB81A37054B937D41B01DB6DE6538C9ADD8B92A176D56CE497636246FDC09371E9AC5C4E29DD81278759D6DB8F55F532D71184A24E6542ADD79C91F877444A6971D0536D376FEFD62717C585146198E6B33781D4F61EC8E5C757CA074F4E36B9BFF878CBF0F94E65555EE551E7A446AEF7FF00DFCA38A4BD8E8CDD67AAEB7CAC776E04F5EB6B4953675C024D8DB75A5FBB9F78FC4FCE476FF34FD256C2290EEFC3F296381FF3CA74E9C1A9C12C1715C3ECB7AB48C6FF000FFCA74E8D7024697935EDFDC3F984D6ACE9D3AA1C1B2E012AEF3DF239D3A74AE004E11B3A746039648B3A74621ED144E9D100A2719D3A002AC7CE9D003846CE9D001046CE9D0015648674E800C88674E88624A6C4FB6DDCDEB3A748908CAE23FEB0FB5F312C687FF25BBBE4674E9CFE84B9347B3BD9F11EB0FA5BCF8FA88B3A74478193AEF1E1EA6576DBDD1674B7C13ECCC1DE62AEE893A6431389EF923459D00189BFCA4E371EEF989D3A20211BC491B74E9D100357E31AFBE74E8C0FFFD9"));

    private static ViewOwnerResponse expectedViewOwnerResponse;
    private static EditOwnerResponse expectedEditOwnerResponse;
    @BeforeAll
    public static void setUp(){
        expectedViewOwnerResponse = new ViewOwnerResponse();
        expectedViewOwnerResponse.setId(1L);
        expectedViewOwnerResponse.setFirstName("first name");
        expectedViewOwnerResponse.setLastName("last name");
        expectedViewOwnerResponse.setMiddleName("middle name");
        expectedViewOwnerResponse.setEmail("email");

        expectedEditOwnerResponse = new EditOwnerResponse(1L,"001",
                "name", "name", "name", "12.09.1990",
                OwnerStatus.NEW, "about", "phone", "viber",
                "telegram", "email", "image");
    }

    @Test
    void getViewProfilePage() throws Exception {
        this.mockMvc.perform(get("/profile").with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(view().name("profile/view-profile"));
    }

    @Test
    void getProfile() throws Exception {
        when(apartmentOwnerService.getViewOwnerResponse()).thenReturn(expectedViewOwnerResponse);
        this.mockMvc.perform(get("/profile/get").with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.firstName").value(expectedViewOwnerResponse.getFirstName()))
                .andExpect(jsonPath("$.middleName").value(expectedViewOwnerResponse.getMiddleName()))
                .andExpect(jsonPath("$.email").value(expectedViewOwnerResponse.getEmail()))
                .andExpect(jsonPath("$.lastName").value(expectedViewOwnerResponse.getLastName()));
    }

    @Test
    void getEditProfilePage() throws Exception {
        this.mockMvc.perform(get("/profile/edit").with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(view().name("profile/edit-profile"));
    }

    @Test
    void getProfileForEdit() throws Exception {
        when(apartmentOwnerService.getEditOwnerResponse()).thenReturn(expectedEditOwnerResponse);
        this.mockMvc.perform(get("/profile/edit/get").with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.firstName").value(expectedEditOwnerResponse.firstName()))
                .andExpect(jsonPath("$.middleName").value(expectedEditOwnerResponse.middleName()))
                .andExpect(jsonPath("$.email").value(expectedEditOwnerResponse.email()))
                .andExpect(jsonPath("$.lastName").value(expectedEditOwnerResponse.lastName()));

    }

    @Test
    void updateProfile() throws Exception {
        ApartmentOwnerRequest apartmentOwnerRequest = new ApartmentOwnerRequest(1L, "name",
                "name", "name", "12.09.1990", OwnerStatus.NEW,
                "about", "+380992401786","+380992401786",
                "@telegram", "email@gmail.com", "password",
                "password", multipartFile);

        ApartmentOwner apartmentOwner = new ApartmentOwner();
        apartmentOwner.setId(1L);

        doNothing().when(apartmentOwnerService).updateProfile(any(ApartmentOwnerRequest.class));

        this.mockMvc.perform(multipart("/profile/edit")
                        .file(multipartFile)
                        .flashAttr("apartmentOwnerRequest",apartmentOwnerRequest)
                        .with(csrf())
                        .with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk());
    }

    @Test
    void updateProfile_Should_Fail_Validation() throws Exception {
        MockMultipartFile multipartFile = new MockMultipartFile("mainImage","file.jpg", MediaType.TEXT_PLAIN_VALUE,"some text".getBytes());

        ApartmentOwnerRequest apartmentOwnerRequest = new ApartmentOwnerRequest(1L, "",
                "", "", "", OwnerStatus.NEW,
                "", "+380992401786","+380992401786",
                "@telegram", "email@gmail.com", "password",
                "password1", multipartFile);

        ApartmentOwner apartmentOwner = new ApartmentOwner();
        apartmentOwner.setId(2L);

        doNothing().when(apartmentOwnerService).updateProfile(any(ApartmentOwnerRequest.class));

        this.mockMvc.perform(multipart("/profile/edit")
                        .file(multipartFile)
                        .flashAttr("apartmentOwnerRequest",apartmentOwnerRequest)
                        .with(csrf())
                        .with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isBadRequest())
                .andExpect(jsonPath("$.size()", is(6)));
    }



    @Test
    void getOwnerStatuses() throws Exception {
        this.mockMvc.perform(get("/profile/get-statuses")
                        .with(user(userDetails)))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.size()", is(3)))
                .andExpect(jsonPath("$.[0]").value(OwnerStatus.NEW.toString()))
                .andExpect(jsonPath("$.[1]").value(OwnerStatus.ACTIVE.toString()))
                .andExpect(jsonPath("$.[2]").value(OwnerStatus.DISABLED.toString()));
    }
}